
\- UCOMPARE : UCOMPARE COMPARE ;
22 CELLS CONSTANT VIEW_FSTACK_SIZE
CREATE VIEW_FSTACK 0 , 0 , VIEW_FSTACK_SIZE ALLOT

: SNFAFIND ( addr len --- 0| nfa )
  CONTEXT
  BEGIN	DUP @ \ DUP H.
  WHILE	>R
	2DUP  R@  @  SEARCH-NFA ?DUP
	IF    RDROP NIP NIP EXIT \ Exit if found.
	THEN
	R> CELL+
  REPEAT @ NIP NIP
;

: VIEWS_SEARCH_  ( adr len -- path | 0  )
  SNFAFIND
 DUP 0= IF BREAK
  VIEW_LINK
 BEGIN  DUP
 WHILE
	2DUP U> IF 2DROP  VIEW_FSTACK @ CELL+ CELL+ BREAK
	DUP CELL+ @ 
	IF   VIEW_FSTACK VIEW_FSTACK CELL+ VIEW_FSTACK_SIZE MOVE
	      DUP VIEW_FSTACK !
	ELSE VIEW_FSTACK CELL+  VIEW_FSTACK VIEW_FSTACK_SIZE MOVE
	THEN
	@
 REPEAT NIP
;

: VIEWS_SEARCH  ( adr len -- nfa path | 0  )
  SNFAFIND
 DUP 0= IF BREAK
 DUP  VIEW_LINK
 BEGIN  2DUP U> WHILE @ REPEAT \ for 

 BEGIN  DUP
 WHILE
	2DUP U> IF 2DROP  VIEW_FSTACK @ CELL+ CELL+ BREAK
	DUP CELL+ @ 
	IF   VIEW_FSTACK VIEW_FSTACK CELL+ VIEW_FSTACK_SIZE MOVE
	      DUP VIEW_FSTACK !
	ELSE VIEW_FSTACK CELL+  VIEW_FSTACK VIEW_FSTACK_SIZE MOVE
	THEN
	@
 REPEAT NIP NIP
;

: VIEW_S.
  VIEW_LINK
 BEGIN  DUP WHILE
	DUP CELL+ @
	IF  dup h.  ." FILE:" DUP CELL+ CELL+ COUNT TYPE 9 emit  DUP
	ELSE  ."   FILE; " dup h. cr OVER IF NIP THEN
	THEN
	@
 REPEAT
 drop
;

: VIEW_z.
  VIEW_LINK
 BEGIN  DUP WHILE
	DUP CELL+ @
	IF cr	 dup h. dup CELL+ CELL+ COUNT TYPE
	   VIEW_FSTACK VIEW_FSTACK CELL+ VIEW_FSTACK_SIZE MOVE
		DUP VIEW_FSTACK !
	ELSE cr  VIEW_FSTACK @ h.
		VIEW_FSTACK CELL+ VIEW_FSTACK VIEW_FSTACK_SIZE MOVE
	THEN
	@
 REPEAT
 drop
;

: VIEW_SEARCHz. ( adr len -- nfa path | 0  )
  SNFAFIND
 DUP 0= IF BREAK
  VIEW_LINK
 BEGIN  DUP WHILE
	DUP CELL+ @
	IF cr	 dup h. dup CELL+ CELL+ COUNT TYPE
	   VIEW_FSTACK VIEW_FSTACK CELL+ VIEW_FSTACK_SIZE MOVE
		DUP VIEW_FSTACK !
	ELSE cr \ VIEW_FSTACK @ h. OVER H.
		2DUP H. H.
		2DUP U>
		IF OVER VIEW_FSTACK @ DUP H. U<
		  IF DROP VIEW_FSTACK @ CELL+ CELL+
		  BREAK
		THEN
		VIEW_FSTACK CELL+ VIEW_FSTACK VIEW_FSTACK_SIZE MOVE
	THEN
	@
 REPEAT
 NIP
;

ALSO EDIT-MOD
: E>   PARSE-NAME VIEWS_SEARCH ?DUP
  IF  NEXT_F COUNT EDIT_FN! NAME>F 4 + L@ 0 SWAP EDIT_XY! EDIT  THEN  
;
PREVIOUS

\EOF

\- VIEW#Y0	0 VALUE VIEW#Y0
\- $EDIT	VECT $EDIT ' 2DROP TO $EDIT

: E>   PARSE-NAME VIEWS_SEARCH ?DUP
  IF  SWAP TO VIEW#Y0 COUNT $EDIT  THEN  
;

\ VIEWS_TYPE 
\ S" HEX" VIEWS_SEARCH
  ' dump TO $EDIT
\ E> +


